 {
  "createdAt": "2025-06-23T08:20:36.567Z",
  "updatedAt": "2025-06-26T06:20:06.000Z",
  "id": "TEKn3NFZrgYXTpSb",
  "name": "My workflow 26",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "af375b41-8347-4e08-b733-e5997b23fe39",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -740,
        360
      ],
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agent Tools for RAG",
        "height": 528.85546469693,
        "width": 583.4552380860637,
        "color": 4
      },
      "id": "a5a17dcf-82dd-417f-bc4d-cdf37260d069",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {},
      "id": "bb9441d2-79d9-4b6e-8990-373a61ff6e1d",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        -600,
        360
      ],
      "notesInFlow": false,
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "content": "## RAG AI Agent with Chat Interface",
        "height": 464.8027193303974,
        "width": 1035.6381264595484
      },
      "id": "3c3a8441-a3dd-48aa-b512-df4d70e95ad7",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1040,
        60
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "5b515d51-df11-4bc4-93e4-3f9d8f39b5f9",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -200,
        40
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a9a245e-f1a1-4282-bb02-a81ffe629f0f",
              "name": "chatInput",
              "value": "={{ $json?.chatInput || $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "b80831d8-c653-4203-8706-adedfdb98f77",
              "name": "sessionId",
              "value": "={{ $json?.sessionId || $json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "20dfa2e4-4a06-40cd-a8c2-a67597c28d7e",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -740,
        140
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "You are an AI assistant specialized in helping users find nursery and landscaping products from SiteOne.\n\nYour knowledge comes from structured data stored in the siteone table in Supabase.\n\nSiteOne products are organized primarily under these fields:\n\nlevel1_taxonomy, level2_taxonomy, level3_taxonomy (for hierarchical category classification)\n\nfinaldescription (product name or label)\n\nbrandname, producttype, productlinedesc (optional filtering by brand or line)\n\n User Query Understanding\n0. ‚úã Greetings or General Intent\nIf the user says:\n\n\"Hi\", \"Hello\", \"I want to buy some products\", \"Find some products\", etc.\n\nüéØ Respond with a list of top-level categories they can choose from, such as:\nPlease select a category to explore:\n- Lighting\n- Irrigation\n- Agronomic Maintenance\n- Landscape Supply\n- Hardscapes & Outdoor Living\n\nIf the user selects or types a top-level category (e.g., ‚ÄúLandscape Supply‚Äù, ‚ÄúIrrigation‚Äù), directly search for that value in level1_taxonomy without asking for subcategories.\n\nüéØ User Query Understanding\n1. General Category Queries\nIf the user gives a general request like:\n\n‚ÄúI need nursery plants‚Äù\n\n‚ÄúShow me special order products‚Äù\n\n‚ÄúWhat do you have in evergreen trees?‚Äù\n\nüëâ Match these keywords to the relevant taxonomy levels (start with level1_taxonomy ).\n\nReturn:\n\nskuid, finaldescription, description, price, product_url, image\n\nSQL Template Example:\nSELECT skuid, finaldescription, description, price, product_url, image\nFROM siteone_new\nWHERE level1_taxonomy ILIKE '%nursery%'\nLIMIT 3;\n\nüîç 3. Application or Use Case Queries\nIf the user describes a goal, application, or use case, such as:\n\n‚ÄúI need something for drainage‚Äù\n‚ÄúLooking for erosion control‚Äù\n‚ÄúNeed a product for weed suppression‚Äù\n‚ÄúWhat can I use for planting beds?‚Äù\n\nüéØ Search in the description column using ILIKE '%<user_input>%'\n\nSELECT skuid, finaldescription, description, price, product_url, image\nFROM siteone_new\nWHERE description ILIKE '%<keywords>%'\nLIMIT 3;\n\nWhen displaying product results, format each product in the following multi-line style:\nProduct: <finaldescription>  \nPrice: $<price>  \nProduct Link: <product_url>  in the link format\nimage (open it directly instead of normal text )\n\n\n2. Specific Product Name Queries\nIf the user specifies a product name (e.g., ‚ÄúPtychosperma Elegans‚Äù or ‚Äú18' palm tree‚Äù), match it against:\n\nfinaldescription ILIKE '%<user_input>%'\n\nReturn all columns for matching records.\n\nSQL Template Example:\nSELECT *\nFROM siteone_new\nWHERE finaldescription ILIKE '%elegans%'\nLIMIT 3;\n\nIf no relevant products are found, respond with:\n‚ÄúI‚Äôm sorry, I couldn‚Äôt find any products matching your query in the siteone product cataloge‚Äù\nIf the user asks for human support or the query is unrelated/missed, respond with:\n\"It seems I couldn't assist with that. For further help, please contact:\nüìû Toll‚ÄëFree: 1-800-748-3663\nüè¢ Address: SiteOne Landscape Supply, 300 Colonial Center Parkway, Suite 600, Roswell, GA 30076, USA\nüåê Website:  [https://www.siteone.com](https://www.siteone.com)\n"
        }
      },
      "id": "69f9b089-b01b-4c0d-906b-2bc6eeafa353",
      "name": "RAG AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -520,
        140
      ]
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use this tool to fetch all available documents, including the table schema if the file is a CSV or Excel file.",
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -460,
        360
      ],
      "id": "47516f66-8856-4c88-b1fd-419c06a9c97d",
      "name": "List Documents",
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Given a file ID, fetches the text from the document.",
        "operation": "executeQuery",
        "query": "SELECT \n    string_agg(content, ' ') as document_text\nFROM documents\n  WHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';",
        "options": {
          "queryReplacement": "={{ $fromAI('file_id') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -320,
        360
      ],
      "id": "77c4b4e9-547e-40d2-a9b7-532f56f6a1d9",
      "name": "Get File Contents",
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=You are an AI assistant specialized in helping users find nursery and landscaping products from SiteOne.\n\nYour knowledge comes from structured data stored in the siteone_new table in Supabase.\n\nSiteOne products are organized primarily under these fields:\n\nlevel1_taxonomy, level2_taxonomy, level3_taxonomy (for hierarchical category classification)\n\nfinaldescription (product name or label)\n\nbrandname, producttype, productlinedesc (optional filtering by brand or line)\n\nüéØ User Query Understanding\n1. General Category Queries\nIf the user gives a general request like:\n\n‚ÄúI need nursery plants‚Äù\n\n‚ÄúShow me special order products‚Äù\n\n‚ÄúWhat do you have in evergreen trees?‚Äù\n\nüëâ Match these keywords to the relevant taxonomy levels (start with level1_taxonomy ).\n\nReturn:\n\nskuid, finaldescription, description, price, product_url, image\n\nSQL Template Example:\nSELECT skuid, finaldescription, description, price, product_url, image\nFROM siteone_new\nWHERE level1_taxonomy ILIKE '%nursery%'\nLIMIT 3;\n\n2. Specific Product Name Queries\nIf the user specifies a product name (e.g., ‚ÄúPtychosperma Elegans‚Äù or ‚Äú18' palm tree‚Äù), match it against:\n\nfinaldescription ILIKE '%<user_input>%'\n\nReturn all columns for matching records.\n\nSQL Template Example:\nSELECT *\nFROM siteone_new\nWHERE finaldescription ILIKE '%elegans%'\nLIMIT 3;\n",
        "operation": "executeQuery",
        "query": "{{ $fromAI('sql_query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -160,
        360
      ],
      "id": "41d869ce-2783-44dc-a076-d8b0c63a8880",
      "name": "Query Document Rows",
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documents",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 10,
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        0,
        120
      ],
      "id": "bf3b94dc-1a17-4483-b990-b4aef3bc6071",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "e7A13j05yIr5nwyM",
          "name": "Supabase account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        260,
        320
      ],
      "id": "50326b09-be46-46ad-8458-e57bb7009d06",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1000,
        140
      ],
      "id": "b3e67841-e06e-4db5-be24-8ddb546441fd",
      "name": "When chat message received",
      "webhookId": "7e315079-e498-42e6-b4a7-3c54c4265e6c"
    }
  ],
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "RAG AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RAG AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "List Documents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get File Contents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Document Rows": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "8bf15641-1ebe-45a5-85d0-aca2140b3ed8",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-06-23T08:20:36.572Z",
      "updatedAt": "2025-06-23T08:20:36.572Z",
      "role": "workflow:owner",
      "workflowId": "TEKn3NFZrgYXTpSb",
      "projectId": "dG371lM6unPJd2qz"
    }
  ],
  "tags": []
}