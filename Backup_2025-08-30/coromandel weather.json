 {
  "createdAt": "2025-07-25T12:17:08.870Z",
  "updatedAt": "2025-08-18T11:38:47.000Z",
  "id": "9l6yPfcJhXxnMbxb",
  "name": "coromandel weather",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.extractedFile?.length && $json.extractedFile.filter((f) => Object.keys(f)?.length > 0).length > 0 ? \"List of File content(s): \\n \" + JSON.stringify($json.extractedFile.filter((f) => Object.keys(f)?.length > 0)) : '' }}\n\n{{ $('When chat message received').item.json.chatInput }}",
        "options": {
          "systemMessage": "=You are a helpful assistant answering users questions. Users can also upload files & images and ask questions.\nFor all the images or files the user upload always first perform RAG search and then normal llm search .\nYour goal is to politely answer user questions and making sure to consider files and images provided before answering.\n\nIf user asks about climate/ weather of any state use any city inside it .\n\nYou are an AI assistant specialized in helping users find farm input products from Coromandel International.\nYour knowledge comes from structured data stored in the coromandel table in Supabase.\nYou help users discover products like:\nFertilizers (e.g., Urea, Complex Fertiliser, StraightK Fertiliser)\nCrop Protection (e.g., Fungicide, Insecticide, Herbicide, Bio-Insecticide)\nGrowth Enhancers (e.g., Plant Growth Regulator, Speciality Nutrients, Organic)\nSeeds (e.g., Maize, Cotton, Paddy)\nOther Inputs (e.g., Implements, Veterinary, General)\n\n\nIf the user‚Äôs question includes any crop name (like cotton, chilli, green gram, red gram, black gram, banana, cabbage, castor, etc.), always perform a RAG search using the PDF vector data stored in Supabase to find the best advisory details.\n\nalso when user asks questions about urea, fertilizers ,bio-insecticides, bio pesticides  , any crop related products or chemicals  always perform a RAG search using the PDF vector data stored in Supabase to find the best advisory details.\n\nAlso when the user send or post an image always perform a RAG search using the PDF vector data stored in Supabase and if you dont find anything relevant use llm knowledge.\n\nUse the retrieved advisory content to provide clear, practical guidance ‚Äî such as recommended products, nutrient management, pest control, sowing methods, or any other relevant crop advice.\n\nIf no relevant advisory is found, respond:\n\"I'm sorry, I couldn't find any crop-specific advisory for your request in the Coromandel knowledge base.\"\n\n\nUser Query Understanding\nIf the user provides a general request (e.g., ‚ÄúI need something for pest control‚Äù or ‚ÄúShow fertilizers‚Äù):\n\nMatch the query to one of the predefined Category Name values:\n\nGeneral, FUNGICIDE, FERTILISERS, HERBICIDE, BIO-INSECTICIDE,IMPLEMENTS, COTTON, StraightK Fertiliser, ORGANIC, INSECTICIDE,\nUrea, SPECIALITY NUTRIENTS, PLANT GROWTH REGULATOR, VETERINARY,\nComplex Fertiliser, MAIZE, PADDY\nSearch Strategy\n\nUse Category Name ILIKE '%<category>%' to retrieve matches from the coromandel table.\n\nShow the entire row for each result.\n\nLimit to the top 5 results for brevity.\n\nIf the user specifies a brand or product name:\n\nAlso match against Brand ILIKE '%<brand>%' or Product Name ILIKE '%<name>%'.\n\nExample Queries & Responses\nUser: \"Show me fertilizers\"\n‚Üí Match: FERTILISERS\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%FERTILISERS%'\nLIMIT 3;\nUser: \"Do you have anything for maize?\"\n‚Üí Match: MAIZE\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%MAIZE%'\nLIMIT 3;\nUser: \"List some insecticides from Advanta\"\n‚Üí Match: INSECTICIDE + Brand filter\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%INSECTICIDE%' AND Brand ILIKE '%Advanta%'\nLIMIT 3;\n\nIf no relevant products are found, respond with:\n‚ÄúI‚Äôm sorry, I couldn‚Äôt find any products matching your query in the Coromandel catalog.‚Äù\nIf the user asks for human support or the query is unrelated/missed, respond with:\n\"It seems I couldn't assist with that. For further help, please contact:\nüìû Toll‚ÄëFree: 1800-425-2828\nüè¢ Address: Coromandel International Limited, Coromandel House, 1‚Äë2‚Äë10 Sardar Patel Road, Secunderabad¬†‚Äì¬†500¬†003, Telangana, India\nüåê Website: https://www.coromandel.biz/contact-us",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1400,
        1440
      ],
      "id": "9c6d648a-985c-42bc-b7e5-5fc1cfda3a15",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "8f46b935-ddbc-46ad-bd52-22e4ebc814d9",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        1360,
        1620
      ],
      "id": "e8244cc7-639b-4fc1-83c5-a2b6dc6c8dd3",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b3784277-1746-477a-b78e-2ca303df8423",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "image/",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "58cd09cb-2657-41b0-86c1-7c9b8f499e90",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "text/plain",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Plain Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1e0475d6-3c04-42d1-a758-b1a79ade7962",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PDF"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e5d9cde7-d9ff-4a2d-ba99-69b4e3b73521",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "text/csv",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "CSV"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7ab50ace-fa94-4b7d-a255-2804994c454a",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/json",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "JSON"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b62c9ad6-b076-4e6c-83d1-092770fef004",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "^(application|text)/xml$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "XML"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ce3cce8a-f092-449f-8d56-931fb2bccced",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "/^(application\\/vnd\\.ms-excel|application\\/vnd\\.openxmlformats-officedocument\\.spreadsheetml\\.sheet)$/",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "XLS, XLSX"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "78650dec-861f-4fcb-83a1-a9d80b61628f",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "=application/rtf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "RTF"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "27ef35f5-34b4-4d2b-bc29-9f799ec4aa60",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "=audio/webm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        640,
        740
      ],
      "id": "18a77483-59a4-42a4-89ac-7bea0a1a2c70",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        180
      ],
      "id": "c45ec7b2-1245-4830-80f7-530a09f9a0b5",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "operation": "text",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "encoding": "utf8"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        180
      ],
      "id": "0d6db794-e16f-42c4-9681-b027be17e5bd",
      "name": "Extract from File",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        340
      ],
      "id": "5a859a1e-b6a9-4308-bb79-cf704b895d9c",
      "name": "Convert to File2"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        500
      ],
      "id": "9bd6b7d5-5828-4c4d-b101-3a9d8d378ee6",
      "name": "Convert to File3"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        660
      ],
      "id": "b0ca58d1-564b-4d7e-ae4c-4ec85b5f3c14",
      "name": "Convert to File4"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        820
      ],
      "id": "a52db78a-722b-4415-9c89-e16fa1107841",
      "name": "Convert to File5"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        1000
      ],
      "id": "3327d2f7-61b9-45f7-afab-65f994efc1bb",
      "name": "Convert to File7"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "base64DataUrlBinary",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "={{ $json.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        940,
        1160
      ],
      "id": "39cd6386-b96c-492a-9b00-88e23bc52232",
      "name": "Convert to File8"
    },
    {
      "parameters": {
        "binaryPropertyName": "base64DataBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        500
      ],
      "id": "38e027b4-a6df-4618-91a8-14075c68bd21",
      "name": "Extract from File2"
    },
    {
      "parameters": {
        "operation": "fromJson",
        "binaryPropertyName": "base64DataBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        660
      ],
      "id": "fa008781-29bc-409c-ae39-83a582fa0197",
      "name": "Extract from File3"
    },
    {
      "parameters": {
        "operation": "xml",
        "binaryPropertyName": "base64DataBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        820
      ],
      "id": "b4c40737-5da1-43e2-bf73-73e621b634aa",
      "name": "Extract from File4"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "base64DataBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        1000
      ],
      "id": "420428cb-e898-4129-a6d2-aaa0ed5c5072",
      "name": "Extract from File6"
    },
    {
      "parameters": {
        "operation": "rtf",
        "binaryPropertyName": "base64DataUrlBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        1160
      ],
      "id": "0e0c2592-3986-4b51-8ae7-4602cdfa7fc5",
      "name": "Extract from File7"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "base64DataBinary",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1100,
        340
      ],
      "id": "e3d00bb2-c78c-4a3a-aaa2-927d64edd493",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        340,
        1020
      ],
      "id": "325aab1e-e576-41d7-85f3-a9db4cab6eaf",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "extractedFile",
        "options": {
          "includeBinaries": true
        }
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        600,
        1440
      ],
      "id": "742c01d0-cd52-4408-abf4-d61b595ae512",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "fieldToSplitOut": "files",
        "options": {
          "includeBinary": true
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        120,
        1020
      ],
      "id": "10164b66-e798-4fbc-89a1-ddbf4c7c8c47",
      "name": "Split Out",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const files = $input.all().at(0)?.binary\nconst isfilesSent = typeof files === 'object' && Object.keys(files)?.length\n\nif(isfilesSent){\n  return { files }\n}\n\nreturn $input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        1020
      ],
      "id": "5ad29612-5d5a-4500-919a-d9be088329e5",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "={{ $json.fileName }}",
          "mimeType": "=audio/wav"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        1420,
        1000
      ],
      "id": "0d8a8de0-bf88-4a45-80a2-f2e7a29fc5bf",
      "name": "Convert to File6"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2040,
        1060
      ],
      "id": "2d53f30e-891f-4c3e-9315-13d9b0dbf344",
      "name": "OpenAI",
      "alwaysOutputData": true,
      "executeOnce": true,
      "notesInFlow": false,
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      },
      "onError": "continueRegularOutput",
      "notes": "failed to convert audio"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "=Table Name: coromandel\nPrimary Columns:\nProduct Name: Name of the product (e.g., ‚ÄúMAGNITE‚Äù, ‚ÄúADVANTA 751 ELITE MAIZE‚Äù)\nBrand: Brand of the product (e.g., ‚ÄúVISHWANATH‚Äù, ‚ÄúCOROMANDEL INTERNATIONAL LIMITED‚Äù)\nManufacturer: Company or agency responsible for manufacturing\nDescription: Contains detailed information and usage (may include crop, formulation, or purpose)\nSize: Pack size (e.g., ‚Äú100 ML‚Äù, ‚Äú4 KG‚Äù)\nItemNumber: Internal identifier\nSKUCode: SKU identifier (optional, may be missing)\nProductId: Numeric unique ID\nCategory Name: Main category (e.g., FUNGICIDE, HERBICIDE, INSECTICIDE, SEEDS)\n\nYou are an AI assistant specialized in helping users find farm input products from Coromandel International.\nYour knowledge comes from structured data stored in the coromandel table in Supabase.\n\nYou help users discover products like:\nFertilizers (e.g., Urea, Complex Fertiliser, StraightK Fertiliser)\nCrop Protection (e.g., Fungicide, Insecticide, Herbicide, Bio-Insecticide)\nGrowth Enhancers (e.g., Plant Growth Regulator, Speciality Nutrients, Organic)\nSeeds (e.g., Maize, Cotton, Paddy)\nOther Inputs (e.g., Implements, Veterinary, General)\n\nUser Query Understanding\nIf the user provides a general request (e.g., ‚ÄúI need something for pest control‚Äù or ‚ÄúShow fertilizers‚Äù):\n\nMatch the query to one of the predefined Category Name values:\n\nGeneral, FUNGICIDE, FERTILISERS, HERBICIDE, BIO-INSECTICIDE,IMPLEMENTS, COTTON, StraightK Fertiliser, ORGANIC, INSECTICIDE,\nUrea, SPECIALITY NUTRIENTS, PLANT GROWTH REGULATOR, VETERINARY,\nComplex Fertiliser, MAIZE, PADDY\nSearch Strategy\n\nUse Category Name ILIKE '%<category>%' to retrieve matches from the coromandel table.\n\nShow the entire row for each result.\n\nLimit to the top 5 results for brevity.\n\nIf the user specifies a brand or product name:\n\nAlso match against Brand ILIKE '%<brand>%' or Product Name ILIKE '%<name>%'.\n\nExample Queries & Responses\nUser: \"Show me fertilizers\"\n‚Üí Match: FERTILISERS\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%FERTILISERS%'\nLIMIT 3;\nUser: \"Do you have anything for maize?\"\n‚Üí Match: MAIZE\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%MAIZE%'\nLIMIT 3;\nUser: \"List some insecticides from Advanta\"\n‚Üí Match: INSECTICIDE + Brand filter\n‚Üí SQL:\nSELECT * FROM coromandel\nWHERE \"Category Name\" ILIKE '%INSECTICIDE%' AND Brand ILIKE '%Advanta%'\nLIMIT 3;",
        "operation": "executeQuery",
        "query": "{{ $fromAI('sql_query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        1620,
        1680
      ],
      "id": "6c4a66d1-1843-48b3-b94e-a971fa23fe54",
      "name": "Query Document Rows",
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Split Out').item.json.fileType }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "cdbd5207-d996-430f-bd5e-a8253198e38e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e9b1a842-a87f-464e-9bf8-847026321ee3",
                    "leftValue": "={{ $('Split Out').item.json.fileType }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": "={{ false }}"
            }
          ]
        },
        "options": {
          "ignoreCase": false
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1760,
        1440
      ],
      "id": "8018a519-cf30-4a3a-baa7-475bf9d3b6b0",
      "name": "Switch1"
    },
    {
      "parameters": {
        "resource": "audio",
        "model": "=gpt-4o-mini-tts",
        "input": "={{ $json.output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1960,
        1340
      ],
      "id": "9ed3a39c-911c-4a50-9311-9bba6c387ac4",
      "name": "generate audio",
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8c7df124-f5ef-4882-837b-67cf8420affb",
        "responseMode": "responseNode",
        "options": {
          "binaryPropertyName": "data"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1020,
        1540
      ],
      "id": "c61a7838-8508-47d7-9105-ac5e7b2d2e02",
      "name": "Webhook",
      "webhookId": "8c7df124-f5ef-4882-837b-67cf8420affb",
      "disabled": true
    },
    {
      "parameters": {
        "respondWith": "binary",
        "responseDataSource": "set",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        2520,
        1620
      ],
      "id": "1b85465c-a4cb-404f-afe0-7a8bcd92e95e",
      "name": "Respond to Webhook",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2800,
        1620
      ],
      "id": "7152612e-d2b9-4bae-8eb4-57bae6adc6da",
      "name": "Code1",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "object",
        "operation": "create",
        "bucketName": "stable-diffusion-images-bucket",
        "objectName": "= {{ $('Split Out').item.json.fileName }}",
        "createData": {},
        "createQuery": {},
        "encryptionHeaders": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.googleCloudStorage",
      "typeVersion": 1,
      "position": [
        2680,
        1220
      ],
      "id": "8f0e0dc1-207b-49fc-b276-b04158e42931",
      "name": "Google Cloud Storage",
      "credentials": {
        "googleCloudStorageOAuth2Api": {
          "id": "CSCLMSPtePqBBBpy",
          "name": "Google Cloud Storage account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\n\nconst bucket = item.bucket;\nconst objectName = item.name;\nconst encodedObjectName = encodeURIComponent(objectName);\n\nconst url = `https://storage.googleapis.com/${bucket}/${encodedObjectName}`;\n\nreturn [\n  {\n    json: {\n      mediaUrl: url\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2540,
        1460
      ],
      "id": "7285738a-e917-4840-97cc-847d7ba5ea51",
      "name": "Code2",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        2460,
        1040
      ],
      "id": "fb5da4e4-e2e6-46ca-8700-533f3eecff3c",
      "name": "Extract from File5",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        1980,
        1540
      ],
      "id": "e8144976-376f-4b59-b23f-11feaebe2a9a",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\n\nconst bucket = item.bucket;\nconst objectName = item.name;\nconst encodedObjectName = encodeURIComponent(objectName);\n\nconst url = `https://storage.googleapis.com/${bucket}/${encodedObjectName}`;\n\nreturn [\n  {\n    json: {\n      audio: url  // This key must be exactly \"audio\" for chatbot to show a player\n    }\n  }\n];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2820,
        1400
      ],
      "id": "5965dd03-eea9-40e6-9313-eb0d1c32e1d1",
      "name": "Code4",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const item           = $input.first().json;\nconst bucket         = item.bucket;\nconst objectName     = item.name;\nconst encodedName    = encodeURIComponent(objectName);\n\n// Public (or signed-URL) to the file you just created/uploaded\nconst url = `https://storage.googleapis.com/${bucket}/${encodedName}`;\n\n// Build the HTML that will be rendered in the chat bubble\nconst html = `\n  <p>Here is your answer üëá</p>\n  <audio controls style=\"width:260px;margin-top:6px;\">\n     <source src=\"${url}\" type=\"audio/wav\">\n     Your browser does not support the audio element.\n  </audio>\n`;\n\nreturn [\n  {\n    json: {\n      output: html          // <-- the ONLY field ChatUI looks at\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2880,
        1260
      ],
      "id": "8cbeaaca-64b1-4b06-8bc3-aca2f72eb155",
      "name": "with cloud storage",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/*  1.  Grab the first item that came from the TTS node           */\nconst item = $input.first();\n\n/*  2.  The OpenAI node stores the file in item.binary.<field>.   *\n *      The default field name is ‚Äúdata‚Äù, but you can change it   *\n *      inside the node under ‚ÄúPut Output in Field‚Äù.               */\nconst bin      = item.binary.data;          // ‚Üñ change if you renamed the field\nconst mime     = bin.mimeType || 'audio/mpeg';\nconst base64   = bin.data;                  // the actual base-64 string\nconst fileName = bin.fileName || 'speech';\n\n/*  3.  Build a data-URI so the browser can play it without       *\n *      downloading from an external server.                      */\nconst dataUri = `data:${mime};base64,${base64}`;\n\n/*  4.  Prepare the HTML that ChatUI will render                  */\nconst html = `\n  <p>Here is your answer üëá</p>\n  <audio controls style=\"width:260px;margin-top:6px;\">\n    <source src=\"${dataUri}\" type=\"${mime}\">\n    Your browser does not support the audio element.\n  </audio>\n`;\n\n/*  5.  Return the message.  IMPORTANT: The field must be called  *\n *      \"output\" for n8n-ChatUI to pick it up.                     */\nreturn [\n  {\n    json: {\n      output: html\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2180,
        1320
      ],
      "id": "41c00c4b-2685-41a8-9fe6-5a456a031936",
      "name": "direct audio"
    },
    {
      "parameters": {
        "cityName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
        "language": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Language', ``, 'string') }}"
      },
      "type": "n8n-nodes-base.openWeatherMapTool",
      "typeVersion": 1,
      "position": [
        1800,
        1700
      ],
      "id": "1f6231a2-3a76-49c9-85de-a6bf3f7c964a",
      "name": "OpenWeatherMap",
      "credentials": {
        "openWeatherMapApi": {
          "id": "VSt77p5KiMEmTCnn",
          "name": "OpenWeatherMap account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documents_coromandel",
        "toolDescription": "Use RAG to look up information in the knowledgebase.",
        "tableName": {
          "__rl": true,
          "value": "documents_coromandel",
          "mode": "list",
          "cachedResultName": "documents_coromandel"
        },
        "topK": 10,
        "options": {
          "queryName": "match_documents_coromandel"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.2,
      "position": [
        1960,
        1720
      ],
      "id": "f03b8fc3-6783-4442-9a18-02b3c3bbccec",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "e7A13j05yIr5nwyM",
          "name": "Supabase account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2280,
        1840
      ],
      "id": "6318ed9f-ac22-476d-978e-105e4e4728e9",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "opkNg3RQ0U03w9cG",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}",
        "tableName": "n8n_chat_histories_coromandel"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1200,
        1820
      ],
      "id": "883f3bee-20cd-4d3a-9583-01721ef4a5fe",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "OppxKTuR17k2wxru",
          "name": "Postgres account 7"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1460,
        1900
      ],
      "id": "5488c8a7-4853-4245-881b-38c40d4e9b2f",
      "name": "Simple Memory",
      "disabled": true
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -360,
        1020
      ],
      "id": "975b9353-1d25-4c26-a049-92b06bce3d90",
      "name": "When chat message received",
      "webhookId": "aea2b8e4-86e8-4406-a09a-80ef13983f8f"
    }
  ],
  "connections": {
    "Convert to File": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Convert to File6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File2": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File3": {
      "main": [
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File4": {
      "main": [
        [
          {
            "node": "Extract from File3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File5": {
      "main": [
        [
          {
            "node": "Extract from File4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File7": {
      "main": [
        [
          {
            "node": "Extract from File6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File8": {
      "main": [
        [
          {
            "node": "Extract from File7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File4": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File6": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File7": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File6": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Query Document Rows": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "generate audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate audio": {
      "main": [
        [
          {
            "node": "direct audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenWeatherMap": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        []
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "0a7c7317-0444-4c6d-9b16-5bd42f3ace54",
  "triggerCount": 1,
  "tags": []
}